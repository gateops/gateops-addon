<?xml version="1.0" encoding="UTF-8"?>
<atlassian-plugin key="${atlassian.plugin.key}" name="${project.name}" plugins-version="2">

<plugin-info>
        <description>Rejects pushes to specific branches unless an external API returns HTTP 200.</description>
        <version>1.0.0</version>
        <vendor name="GateOps" url="http://www.gateops.com"/>
    <param name="plugin-icon">images/pluginIcon.png</param>
    <param name="plugin-logo">images/pluginLogo.png</param>
</plugin-info>

    <!-- Compile-time pre-compiled Soy templates & other static assets -->
    <web-resource key="external-api-hook-resources" name="External API Hook Resources">
        <!-- Bitbucket’ın çekirdek UI kaynaklarına bağımlılık -->
        <dependency>com.atlassian.auiplugin:ajs</dependency>
        <dependency>com.atlassian.bitbucket.server.bitbucket-web-resources</dependency>

        <!-- Soy tarafından derlenen JS şablon dosyası -->
        <resource type="download" name="externalapi-config.soy.js" location="templates/externalapi-config.soy.js"/>
        <resource type="download" name="external-api-hook.css" location="css/external-api-hook.css"/>
        <resource type="download" name="external-api-hook.js" location="js/external-api-hook.js"/>
        <resource type="download" name="images/" location="images"/>

        <!-- Bu kaynak yalnızca repository ayar sayfalarında yüklenir -->
        <context>bitbucket.hook.settings</context>
    </web-resource>

    <!-- Pre-receive hook tanımı -->
    <repository-hook key="externalApiHook"
                     name="External API Branch Hook"
                     class="com.gateops.bitbucket.hooks.ExternalApiPreReceiveHook">
        <description>Call external API on push and reject if it returns an error.</description>

        <!-- Yapılandırma formu (config form) -->
        <config-form key="externalApiHook-config"
                     name="External API Hook Configuration">
            <!-- Soy namespace + template adı -->
            <view>com.gateops.bitbucket.hooks.externalapi.formContents</view>
            <!-- Yukarıda tanımlı web-resource’u yükle -->
            <resource name="external-api-hook-resources"/>
        </config-form>

        <!-- Kullanıcıdan gelen form verilerini doğrulamak için validator -->
        <validator>com.gateops.bitbucket.validator.ExternalApiHookValidator</validator>
    </repository-hook>

</atlassian-plugin>
